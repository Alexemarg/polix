!function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1463)}({123:function(t,e,i){"use strict";e.a=function(...t){return Promise.all(t.map(t=>new Promise((e,i)=>{document.head.querySelector(`script[href="${t}.js"]`)&&e();const r=document.createElement("script");r.src=t+".js",r.onload=e,r.onerror=i,document.head.append(r)})))}},124:function(t,e,i){"use strict";e.a=function(t,e,i,r){let n=[];const s=2===r.length&&"number"==typeof r[0]&&"number"==typeof r[1];for(let a=0;a<=i;a++){let i=s?r[0]:r[a][0],o=s?r[1]:r[a][1];n.push(t.addTilesetImage(e+a,null,i,o,null,null,a))}return n}},125:function(t,e,i){"use strict";i.d(e,"a",(function(){return u}));var r={from:{bool:t=>!!+t,json(t,e){if("string"!=typeof t)return e;try{return JSON.parse(t)}catch(t){return e}},time:{minutes:t=>new Date(6e4*t)}},to:{bool:t=>+t,json:JSON.stringify,time:{minutes:t=>Math.trunc(t/6e4)}},copy:t=>JSON.parse(JSON.stringify(t))},n={stringify:t=>t.layer.data.map(t=>t.map(t=>t.index)).map(t=>t.join(" ")).join("|"),parse:t=>t.split("|").map(t=>t.split(" ").map(t=>+t))};function s(t,e){return new Array(e).fill([]).map(()=>new Array(t).fill(-1))}function a(t,e,i){return function(t,e,i){let r=t.map(t=>t.length>=e?t.splice(0,e):t.concat(new Array(e-t.length).fill(-1)));return r.length>=i?r.length=i:r=r.concat(s(e,i-t.length)),r}(t?n.parse(t):s(e,i),e,i)}function o(t){return"string"==typeof t?r.from.json(t):t}const c=navigator.language||navigator.userLanguage,l=new Intl.DateTimeFormat(c,{weekday:"long",year:"numeric",month:"short",day:"2-digit",hour:"numeric",minute:"numeric"});class u{constructor(t={}){this.project=t,this.maps=this.project.m||[],this.images=this.project.i||{},this.anims=this.project.n||[],this.audio=this.project.a||{},this.datas=this.project.d||{},this.rules=this.project.r||[],this.manifest=this.project.mn||{},this.cellSize=this.manifest.cs||16}v(){return this.manifest.v_s}projName(t="",e=this.project){return o(e).mn.n||t}projDescr(t="",e=this.project){return o(e).mn.d||t}projPreview(t=this.project){return o(t).mn.pv||o(t).mn.pv_a||"img/preview.png"}isHasAutoPreview(t=this.project){return null!=o(t).mn.pv_a}projTimeUpd(t=this.project){const e=r.from.time.minutes(t.mn.t_u);return l.format(e).replace(/^./,t=>t.toUpperCase())}animData(t){const e=this.anims[t],i=this.imgByCAI(e._c,e.i);return{fWidth:e.w,fHeight:e.h,sprite:i,fStart:e.fs,fEnd:e.fe,fRate:e.s,yoyo:e.yy}}animCfg(t,e,i,r){const n=this.anims.filter(t=>t._c===e)[i];return{key:""+i,frames:n.fs!==n.fe?t.anims.generateFrameNumbers(r,{start:n.fs,end:n.fe}):[{key:r,frame:n.fs}],frameRate:n.s,yoyo:n.yy,repeat:n.r||-1}}audAll(){return{e:this.audio.e.map((t,e)=>({id:e,name:t.n,info:t.i,data:t.d})),m:this.audio.m.map((t,e)=>({id:e,name:t.n,info:t.i,data:t.d}))}}imgByCAI(t,e){try{return this.images[t][e].d}catch(t){return""}}imgNameByCAI(t,e){try{return this.images[t][e].n}catch(t){return""}}mapSize(t){const e="number"==typeof t?this.maps[t].m:t.m;return{width:e.w,height:e.h}}mapColor(t){return+("0x"+(("number"==typeof t?this.maps[t].m:t.m)||"000000").c)}mapData(t){const e=this.maps[t],i=this.mapSize(e),n=e.l;return{data:{blocksProps:e.d.p},layers:{s:r.from.json(n.s||{}),m:a(n.m,i.width,i.height)}}}mapGravity(t){return this.maps[t].m.p_g}d_blocks(){return this.datas.b||[]}sumBlockDataList(){const t=r.copy(this.d_blocks());return t.forEach(t=>{t.i=this.imgByCAI("b",t.i)}),t}collisblBlocksIds(){const t=[];return this.d_blocks().forEach((e,i)=>{e.is_p&&t.push(i)}),t}blocksTextures(){return this.sumBlockDataList().map(t=>t.i||t.c)}d_structs(){return this.datas.s||[]}sumStructDataList(){return r.copy(this.d_structs()).map(t=>({name:t.n,texture:this.imgByCAI("s",t.i),width:t.w*this.cellSize,height:t.h*this.cellSize,color:t.c,isPhysical:t.is_p}))}structsTextures(){return this.sumStructDataList().map(t=>t.texture||t.color)}structsSizeList(){return this.d_structs().map(t=>[t.w*this.cellSize,t.h*this.cellSize])}d_entities(){return this.datas.e||[]}getEntityData(t){const e=this.d_entities()[t];let i=(e.al||"").split(" ").filter(t=>t.length).map(t=>+t);return""===i[0]&&(i=null),{tid:t,name:e.n,rules:e.rls,categ:"e",descr:e.d,width:e.w*this.cellSize,height:e.h*this.cellSize,anims:i,sprite:"number"==typeof e.i?this.imgByCAI("e",e.i):"",color:+("0x"+e.c)||21760,velX:e.vx,velY:e.vy,maxVelX:e.mx,maxVelY:e.my,acelX:e.ax,acelY:e.ay,dragX:e.dx,dragY:e.dy}}}},1463:function(t,e,i){"use strict";i.r(e);var r=i(123),n=i(62),s=i(15),a=i(125),o=i(45);let c;const l={};var u={init(t,e){c=t;for(const t in e){const[i,r]=t.split(".");this.set(+i,+r,e[t])}},set(t,e,i={}){l[t+"."+e]=i,c.getTileAt(t,e,!0).properties=i},get:(t,e)=>l[t+"."+e]||{},getAll:()=>l},d=i(85),m=i(124),h=function(t){let e=t.input.keyboard.createCursorKeys();return new Phaser.Cameras.Controls.FixedKeyControl({camera:t.cameras.main,up:e.up,right:e.right,down:e.down,left:e.left})};var p={marker:{},create(t,e,i,r=i){this.marker=t.add.graphics({lineStyle:e}),this.setSize(i,r)},setPosition(t,e){this.marker.setPosition(t,e)},setSize(t,e=t){this.marker.clear(),this.marker.strokeRect(0,0,t,e)}},f=function(t,e,i,r){return new(i||(i=Promise))((function(n,s){function a(t){try{c(r.next(t))}catch(t){s(t)}}function o(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}c((r=r.apply(t,e||[])).next())}))};let g;Object(r.a)("e/libs/phaser_3.23.0").then(()=>{window.$triggers.start=function(t){!function(t){const{Phaser:e}=window.$libs;let i,r,c,l=!1,y=!1,w={left:!1,right:!1},b={};const S=new a.a(t.project),j=S.mapData(t.mapId),v=S.blocksTextures(),x=S.sumStructDataList(),k=S.structsTextures(),P=S.structsSizeList(),_=S.mapSize(t.mapId),T=0,z=1,O=S.cellSize;class D extends e.Scene{constructor(){super("demo")}preload(){}create(){return f(this,void 0,void 0,(function*(){const a=this.cameras.main,f=v.length-1;yield Object(d.a)(this,s.a.block,v,[O,O]),yield Object(d.a)(this,s.a.struct,k,P);let T=this.add.graphics({fillStyle:{color:S.mapColor(t.mapId)}});o.a.init(this,j.layers.s,x,O,!0),c=this.make.tilemap({key:s.a.map_main,data:j.layers.m,width:_.width,height:_.height,tileWidth:O,tileHeight:O}),T.fillRect(0,0,c.widthInPixels,c.heightInPixels);const z=Object(m.a)(c,s.a.block,f,[O,O]);function D(t){w.left=t.leftButtonDown(),w.right=t.rightButtonDown(),y=!t.noButtonDown()}u.init(c,j.data.blocksProps),b.m=c.createDynamicLayer("layer",z,0,0),i=h(this),p.create(this,{width:2,color:52224,alpha:1},O),g=this.add.graphics({lineStyle:{width:2,color:43775,alpha:1}}),g.strokeRect(0,0,O,O),r=this.input.keyboard.addKey(e.Input.Keyboard.KeyCodes.SHIFT),this.input.mouse.disableContextMenu(),this.input.on("pointerup",D),this.input.on("pointerdown",t=>{D(t),t.middleButtonDown()&&(a.zoom=1)}),this.input.on("wheel",(function(t,e,i,r,s){const o=a.zoom+r*n.a.base.editor.zoomSpeed;a.zoom=Math.min(Math.max(o,n.a.base.editor.zoomInterval[0]),n.a.base.editor.zoomInterval[1])})),l=!0}))}update(t,e){if(!l)return;i.speedX=i.speedY=n.a.base.editor.scrollMapSpeed[+r.isDown],i.update(e);let s=this.input.activePointer.positionToCamera(this.cameras.main),{x:a,y:d}=c.worldToTileXY(s.x,s.y);if(p.setPosition(c.tileToWorldX(a),c.tileToWorldY(d)),w.left)switch(window.$data.editObjectType){case T:p.setSize(O);const t=c.getTileAt(a,d,!0);if(y&&null!=t){const e=r.isDown?window.$data.sBlockIdAlt:window.$data.sBlockId;null!==e&&t.index!==e&&c.putTileAt(e,a,d)}break;case z:const e=window.$data.sStructId;if(-1!==e?p.setSize(P[e][0],P[e][1]):p.setSize(O),y){const t=r.isDown?window.$data.sStructIdAlt:window.$data.sStructId;o.a.putStruct(a,d,t)}}else w.right&&(g.setPosition(c.tileToWorldX(a),c.tileToWorldY(d)),window.$triggers.setBlockPropsEdit(u.get(a,d),(function(t){u.set(a,d,t)})))}}const I=n.a.editor(t),A=new e.Game(Object.assign(Object.assign({},I),{scene:D})),B={setAudioSettings(t){const e=A.sound;null!=t.vol&&(e.volume=t.vol),null!=t.isMute&&(e.mute=t.isMute)},getMapData:()=>(b.s=o.a.getData(),{data:{blocksProps:u.getAll()},layers:b}),destroy(){A.destroy(!0),Object.assign(window.$triggers,{setAudioSettings:()=>0,setLayer:()=>0,getMapData:()=>0,destroy:()=>0})}};Object.assign(window.$triggers,B),window.$triggers.setAudioSettings(window.$data.aud)}(t)},window.$info.loadedEngineType="editor",window.$events.onEngineLoad()})},15:function(t,e,i){"use strict";e.a={map_main:"0",img_tileset_blocks:"1",block:"B",struct:"S",texture:"T",layer:"L",sound:"N",music:"M"}},45:function(t,e,i){"use strict";var r=i(15);let n,s,a,o,c,l,u=[],d=!1;e.a={init(t,e,i,r,u=!1){n=new Map,s=new Map,a=t,c=r,o=i,l=u;for(const t in e)d=!0,this.putStruct(...t.split("."),e[t])},getData:()=>d?function(t){const e={};return[...t.entries()].forEach(t=>{e[t[0]]=t[1]}),e}(n):{},putStruct(t,e,i){const m=t+"."+e;let h=!1;if(n.get(m)===i)return h;if(n.has(m)&&(this.deleteStruct(t,e),h=!0),-1===i)return h;n.set(m,i),d=!0,h=!0;const p=o[i];let f;const g=t*c,y=e*c,w=r.a.struct+i;return l?f=a.add.image(g,y,w).setOrigin(0,0):(f=a.physics.add.image(g,y,w).setOrigin(0,0),p.isPhysical&&u.push(f),f.setImmovable(!0),f.body.allowGravity=!1),f.setDisplaySize(p.width,p.height),s.set(m,f),h},deleteStruct(t,e){const i=t+"."+e;n.delete(i),s.get(i).destroy(),s.delete(i)},addCollider(t){d&&a.physics.add.collider(u,t)}}},62:function(t,e,i){"use strict";function r(t){return{type:t.WEBGL,pixelArt:!0,scale:{autoCenter:Phaser.Scale.CENTER_BOTH,mode:t.Scale.ENVELOP}}}e.a={base:{editor:{scrollMapSpeed:[.8,2],zoomInterval:[.2,2],zoomSpeed:.001}},game(t){const{Phaser:e}=window.$libs,i=Object.assign(Object.assign({},r(e)),{parent:t.parent,physics:{default:"arcade",arcade:{gravity:{y:600},debug:window.$data.isDebug}}});return i.scale.fullscreenTarget=t.parent,i},editor(t){const{Phaser:e}=window.$libs,i=Object.assign({},r(e));return i.scale.parent=t.parent,i}}},85:function(t,e,i){"use strict";e.a=function(t,e,i,r){return new Promise((n,s)=>{if(!i||!i.length)return n();let a=i.length;t.textures.on("addtexture",(function e(){a--,a<=0&&(t.textures.off("addtexture",e),clearTimeout(void 0),n())}));const o=2===r.length&&"number"==typeof r[0]&&"number"==typeof r[1];i.forEach((i,n)=>{const s=e+n;let c=o?r[0]:r[n][0],l=o?r[1]:r[n][1];if(6!==i.length)t.textures.addBase64(s,i);else{const e=+("0x"+i);let r=t.make.graphics({add:!1,fillStyle:{color:e}});r.fillRect(0,0,c,l),r.generateTexture(s,c,l),a--}}),a<=0&&n()})}}});