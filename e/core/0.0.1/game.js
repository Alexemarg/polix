!function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1462)}({123:function(t,e,n){"use strict";e.a=function(...t){return Promise.all(t.map(t=>new Promise((e,n)=>{document.head.querySelector(`script[href="${t}.js"]`)&&e();const i=document.createElement("script");i.src=t+".js",i.onload=e,i.onerror=n,document.head.append(i)})))}},124:function(t,e,n){"use strict";e.a=function(t,e,n,i){let s=[];const r=2===i.length&&"number"==typeof i[0]&&"number"==typeof i[1];for(let a=0;a<=n;a++){let n=r?i[0]:i[a][0],o=r?i[1]:i[a][1];s.push(t.addTilesetImage(e+a,null,n,o,null,null,a))}return s}},125:function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var i={from:{bool:t=>!!+t,json(t,e){if("string"!=typeof t)return e;try{return JSON.parse(t)}catch(t){return e}},time:{minutes:t=>new Date(6e4*t)}},to:{bool:t=>+t,json:JSON.stringify,time:{minutes:t=>Math.trunc(t/6e4)}},copy:t=>JSON.parse(JSON.stringify(t))},s={stringify:t=>t.layer.data.map(t=>t.map(t=>t.index)).map(t=>t.join(" ")).join("|"),parse:t=>t.split("|").map(t=>t.split(" ").map(t=>+t))};function r(t,e){return new Array(e).fill([]).map(()=>new Array(t).fill(-1))}function a(t,e,n){return function(t,e,n){let i=t.map(t=>t.length>=e?t.splice(0,e):t.concat(new Array(e-t.length).fill(-1)));return i.length>=n?i.length=n:i=i.concat(r(e,n-t.length)),i}(t?s.parse(t):r(e,n),e,n)}function o(t){return"string"==typeof t?i.from.json(t):t}const c=navigator.language||navigator.userLanguage,u=new Intl.DateTimeFormat(c,{weekday:"long",year:"numeric",month:"short",day:"2-digit",hour:"numeric",minute:"numeric"});class l{constructor(t={}){this.project=t,this.maps=this.project.m||[],this.images=this.project.i||{},this.anims=this.project.n||[],this.audio=this.project.a||{},this.datas=this.project.d||{},this.rules=this.project.r||[],this.manifest=this.project.mn||{},this.cellSize=this.manifest.cs||16}v(){return this.manifest.v_s}projName(t="",e=this.project){return o(e).mn.n||t}projDescr(t="",e=this.project){return o(e).mn.d||t}projPreview(t=this.project){return o(t).mn.pv||o(t).mn.pv_a||"img/preview.png"}isHasAutoPreview(t=this.project){return null!=o(t).mn.pv_a}projTimeUpd(t=this.project){const e=i.from.time.minutes(t.mn.t_u);return u.format(e).replace(/^./,t=>t.toUpperCase())}animData(t){const e=this.anims[t],n=this.imgByCAI(e._c,e.i);return{fWidth:e.w,fHeight:e.h,sprite:n,fStart:e.fs,fEnd:e.fe,fRate:e.s,yoyo:e.yy}}animCfg(t,e,n,i){const s=this.anims.filter(t=>t._c===e)[n];return{key:""+n,frames:s.fs!==s.fe?t.anims.generateFrameNumbers(i,{start:s.fs,end:s.fe}):[{key:i,frame:s.fs}],frameRate:s.s,yoyo:s.yy,repeat:s.r||-1}}audAll(){return{e:this.audio.e.map((t,e)=>({id:e,name:t.n,info:t.i,data:t.d})),m:this.audio.m.map((t,e)=>({id:e,name:t.n,info:t.i,data:t.d}))}}imgByCAI(t,e){try{return this.images[t][e].d}catch(t){return""}}imgNameByCAI(t,e){try{return this.images[t][e].n}catch(t){return""}}mapSize(t){const e="number"==typeof t?this.maps[t].m:t.m;return{width:e.w,height:e.h}}mapColor(t){return+("0x"+(("number"==typeof t?this.maps[t].m:t.m)||"000000").c)}mapData(t){const e=this.maps[t],n=this.mapSize(e),s=e.l;return{data:{blocksProps:e.d.p},layers:{s:i.from.json(s.s||{}),m:a(s.m,n.width,n.height)}}}mapGravity(t){return this.maps[t].m.p_g}d_blocks(){return this.datas.b||[]}sumBlockDataList(){const t=i.copy(this.d_blocks());return t.forEach(t=>{t.i=this.imgByCAI("b",t.i)}),t}collisblBlocksIds(){const t=[];return this.d_blocks().forEach((e,n)=>{e.is_p&&t.push(n)}),t}blocksTextures(){return this.sumBlockDataList().map(t=>t.i||t.c)}d_structs(){return this.datas.s||[]}sumStructDataList(){return i.copy(this.d_structs()).map(t=>({name:t.n,texture:this.imgByCAI("s",t.i),width:t.w*this.cellSize,height:t.h*this.cellSize,color:t.c,isPhysical:t.is_p}))}structsTextures(){return this.sumStructDataList().map(t=>t.texture||t.color)}structsSizeList(){return this.d_structs().map(t=>[t.w*this.cellSize,t.h*this.cellSize])}d_entities(){return this.datas.e||[]}getEntityData(t){const e=this.d_entities()[t];let n=(e.al||"").split(" ").filter(t=>t.length).map(t=>+t);return""===n[0]&&(n=null),{tid:t,name:e.n,rules:e.rls,categ:"e",descr:e.d,width:e.w*this.cellSize,height:e.h*this.cellSize,anims:n,sprite:"number"==typeof e.i?this.imgByCAI("e",e.i):"",color:+("0x"+e.c)||21760,velX:e.vx,velY:e.vy,maxVelX:e.mx,maxVelY:e.my,acelX:e.ax,acelY:e.ay,dragX:e.dx,dragY:e.dy}}}},1462:function(t,e,n){"use strict";n.r(e);var i=n(123),s=n(62),r=n(15),a=n(125),o=n(85),c=n(124),u=n(552),l=n.n(u),h=function(t,e,n){if(0!==n.length)return new Promise((i,s)=>{const r=new window.AudioContext;let a=n.length;n.forEach(n=>{r.decodeAudioData(l()(n.data),s=>{t.cache.audio.add(e+n.id,s),0==--a&&i()},t=>{console.error("Ошибка декодирования аудио-данных: "+t.err),s()})})})};var d=function(t,e,n,i){return new(n||(n=Promise))((function(s,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function o(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,o)}c((i=i.apply(t,e||[])).next())}))},p=function(t,e,n,i=new Map,s=[]){const r=n.a;function a(t,e){void 0!==t&&i.set(t,e)}return function(n,o=[],c=[]){return d(this,void 0,void 0,(function*(){if(!function(t,e){for(let n=0;n<t.length;n++){const i=t[n],s=e[n];if(null===i)return!1;if(s instanceof Set)return!s.has(i);if(i!==s)return!0}return!1}(s,c)){for(const n of r){const[s,r,c]=n[0].split("."),u=n[1];yield e[r][c](u,t.createGetVarValFunction(i,o),a)}n()}}))}};let m,f=!0;var y={isDefined:!1,hero:()=>m,setEnableState(t){f=t},isEnabled:()=>f,setHero(t){m=t,this.isDefined=!0,m.ondestroy=t=>{this.isDefined=!1,m=null}}};function b(t){return JSON.parse(JSON.stringify(t))}function g(t,e){return Object.keys(t)[e]}function v(t,e){return t[Object.keys(t)[e]]}var w=n(553);const x=new class{constructor(t){this.schema=t}newRulesPack(t){return{n:t,e:null,v:[],a:[],s:{}}}rulesPack(t){return{name:t.n,event:t.e,vars:t.v,actions:t.a,settings:t.s||{}}}rulesPacksVars(t){const e=t.e?this.ruleData(t.e[0]).args:null;return[...(e||[]).map(t=>"#"+t),...t.v.map(t=>"@"+t[1])]}rulesPacksVarsMap(t){const e=t.e?this.ruleData(t.e[0]).args:null;return new Map((e||[]).map((t,e)=>["#"+t,e]).concat(t.v?t.v.map(t=>["@"+t[1],t[0]]):[]))}createGetVarValFunction(t,e){return function(n){if("string"!=typeof n)return n;const i=t.get(n);return n.startsWith("#")?e[i]:n.startsWith("@")?i:n}}compressVariableNames(t){const e=this.rulesPacksVars(t),n={},i=b(t);return e.forEach((t,e)=>n[t]=t.match(/^./)+e),i.a.forEach(t=>{t[1]=t[1].map(t=>n[t]||t)}),i}ruleData(t){const[e,n,i]=t.split(".").map(t=>+t),s=v(this.schema,e),r=v(s,n),a=b(v(r,i)),o=a.$;return delete a.$,{tid:e,cid:n,mid:i,isEvent:0===e,isAction:1===e,typeName:g(this.schema,e),ctxName:g(s,n),methName:g(r,i),methProps:0!==Object.keys(a).length?a:null,args:o}}ruleList(t,e){const n=v(this.schema,t),i={};return Object.keys(n).forEach((s,r)=>{null!=e&&e!==r||(i[s]=function(t,e){const n={};return Object.keys(t).forEach((t,i)=>{n[t]=e+i}),n}(n[s],`${t}.${r}.`))}),i}}(w);let _=[];var k={event:{GAME_INITIALIZED:"1.0",GAME_ENDED:"1.1",ENT_SPAWNED:"2.0",ENT_DIED:"2.1",ENT_TOUCHED_ENTITY:"2.2",ENT_TOUCHED_BLOCK:"2.3",ENT_IN_THE_REGION:"2.4",ENT_JUMP:"2.5"},newRuler:()=>new Phaser.Events.EventEmitter,setContext(t){var e;_.push((e=t,[function(t,n,i){const[s]=t;return new Promise(t=>e.scene.time.delayedCall(s,t))}]),function(t){return[function([e],n,i){k.emit(t.ruler,k.event.GAME_ENDED,[],[!!e]),t.startdata.finishCB(!e)}]}(t),function(t){return[function([e,n,i,s],r,a){a(s,t.entman.create(e,[n,i]))},function([t],e,n){e(t).kill()},function([e],n,i){const s=n(e);t.scene.cameras.main.startFollow(s.object,!0),y.setHero(s)},function([t,e],n,i){n(t).addTouchingBlock(e)},function([t,e],n,i){n(t).setCheckingTouchingEntity(e)},function([t,e],n,i){n(t).jump(e)},function([t,e,n],i,s){const r=i(t);r.movingTask.x=e,r.movingTask.y=n},function([t,e],n,i){n(t).movingTask[e?"x":"y"]*=-1},function([t,e,n,i],s,r){const a=s(t);i?a.setImpulse(e,n):a.setMove(e,n)}]}(t),function(t){return[function([e],n,i){const s=n(e);t.scene.cameras.main.startFollow(s.object,!0,1,1)},function([e],n,i){t.scene.cameras.main.setZoom(e)},function([e,n],i,s){t.scene.cameras.main.setLerp(e,n)}]}(t),function(t){return[function([e],n,i){const s=n(e);t.map.removeTile(s)},function([e,n],i,s){const r=i(e);t.map.putTileAt(n,r.x,r.y)}]}(t),function(t){return[function(e,n,i){const[s]=e;t.scene.sound.play(r.a.sound+s)},function(e,n,i){const[s]=e;t.scene.sound.play(r.a.music+s)},function(e,n,i){const[s]=e;t.scene.sound.stopByKey(r.a.music+s)},function(e,n,i){const[s]=e;t.scene.sound.stopByKey(r.a.music+s)}]}(t),function(t){return[function([t,e],n,i){n(t).playAnim(e)},function([t,e,n],i,s){i(t).props.isFlippable={x:e,y:n}},function([e,n],i,s){t.scene.cameras.main.shake(e||void 0,n||void 0)},function([e,n],i,s){t.scene.cameras.main.fadeOut(e,...n.match(/.{2}/g).map(t=>+("0x"+t)))}]}(t),"Event",[function([t],e,n){y.setEnableState(t)}])},parse(t,e){e.forEach(e=>{if(null==e.e||0===e.a.length)return;const n=e.e,i=n[0].replace(/\d+\./,"");const s=n[1],r=x.rulesPacksVarsMap(e);(e.s||{}).i_o?t.once(i,p(x,_,e,r,s)):t.on(i,p(x,_,e,r,s))})},emit:(t,e,n,i)=>new Promise(s=>{t.emit(e,s,n,i)||s()})},E=n(45);const S=document.createElement("div");S.style.display="none",document.body.prepend(S);var j=function(t,e,n,i){return new(n||(n=Promise))((function(s,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function o(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,o)}c((i=i.apply(t,e||[])).next())}))};function I(t){return new Set([t.none?0:5,t.up?1:6,t.right?2:7,t.down?3:8,t.left?4:9])}class A{constructor(t,e,n,i,s){this.ctx=t,this.scene=e,this.projparser=n,this.entman=i,this.instr=s,this.isDead=!1,this.touchingBlockIds={all:new Set,collidable:new Set},this.props={isFlippable:{x:!1,y:!1}},this.movingTask={x:null,y:null},this.isFreezed=!0,this.directX=!0,this.directY=!0,this.touchingBlocks={collidable:[],noncldbl:[]},this.ondestroy=t=>0;const r=this.instr,a=r.data;if(this.object=this.scene.physics.add[r.isHasSprite?"sprite":"image"](0,0,r.spriteKey),this.object.$=this,this.tid=a.tid,this.object.setDisplaySize(a.width,a.height),null!=a.maxVelX&&(this.object.body.maxVelocity.x=a.maxVelX),null!=a.maxVelY&&(this.object.body.maxVelocity.y=a.maxVelY),0!==a.anims.length){const t=function(t,e,n,i,s){const r=[];return i.forEach(i=>{const a=e.animCfg(t,n,i,s);t.anims.create(a),r.push(a.key)}),r}(this.scene,this.projparser,a.categ,a.anims,r.spriteKey);this.animmain=t[0],this.playAnim(this.animmain)}E.a.addCollider(this.object),this.scene.physics.add.existing(this.object),this.scene.physics.add.collider(this.object,this.entman.colliderlayer),this.ruler=k.newRuler(),k.parse(this.ruler,this.instr.data.rules),k.emit(this.ruler,k.event.ENT_SPAWNED,[this])}setDirectX(t){this.directX=t,this.props.isFlippable.x&&(this.object.flipX=!t)}setDirectY(t){this.directY=t,this.props.isFlippable.y&&(this.object.flipY=t)}init(){this.object.body.setDragX(this.instr.data.dragX),this.object.body.setDragY(this.instr.data.dragY),this.object.setCollideWorldBounds(!0),this.scene.physics.world.on("tilecollide",(t,e,n)=>{if(t.$===this&&this.touchingBlockIds.collidable.has(e.index)){const n=I(t.body.blocked);k.emit(this.ruler,k.event.ENT_TOUCHED_BLOCK,[this,e],[e.index,n])}})}update(){this.isNotInCamera()||(this.isDead||this.setMove(this.movingTask.x,this.movingTask.y),0!==this.touchingBlocks.noncldbl.length&&this.scene.physics.world.overlapTiles(this.object,this.touchingBlocks.noncldbl,(t,e)=>{const n=I(this.object.body.blocked);k.emit(this.ruler,k.event.ENT_TOUCHED_BLOCK,[this,e],[e.index,n]),this.touchingBlocks.noncldbl=this.scene.map.filterTiles(t=>this.touchingBlockIds.all.has(t.index)&&!this.ctx.blocks.collidableList.has(t.index))}))}destroy(){this.ondestroy(),this.entman.list.delete(this),this.object.destroy(),this.ruler.destroy()}isNotInCamera(){return!this.scene.cameras.main.worldView.contains(this.object.x,this.object.y)}isOnGround(){return this.object.body.blocked.down||this.object.body.touching.down}setCheckingTouchingEntity(t){this.scene.physics.add.overlap(this.object,this.entman.groups[t],(t,e)=>{if(!e.$.isDead){if(this.lastTouchedEntity!==e.$){const t=I(this.object.body.touching);k.emit(this.ruler,k.event.ENT_TOUCHED_ENTITY,[this,e.$],[e.$.tid,t])}this.lastTouchedEntity=e.$}},null)}addTouchingBlock(t){this.touchingBlockIds.all.add(t),this.ctx.blocks.collidableList.has(t)&&(this.touchingBlockIds.collidable.add(t),this.object.body.onCollide=!0),this.touchingBlocks.noncldbl.push(...this.scene.map.filterTiles(e=>!this.ctx.blocks.collidableList.has(e.index)&&e.index===t))}setPosition(t,e){const n=this.projparser.cellSize*t,i=this.projparser.cellSize*e;this.object.setOrigin(0,0).setPosition(n,i)}setMove(t,e){null!=t&&(this.object.body.setAccelerationX(this.instr.data.acelX*t),this.setDirectX(t>0)),null!=e&&(this.object.body.setAccelerationY(this.instr.data.acelY*-e),this.setDirectY(e<0))}setImpulse(t,e){null!=t&&(this.object.body.setVelocityX(this.instr.data.velX*t),this.setDirectX(t>0)),null!=e&&(this.object.body.setVelocityY(this.instr.data.velY*-e),this.setDirectY(e<0))}jump(t){!t&&this.isDead||(this.setImpulse(null,1),k.emit(this.ruler,k.event.ENT_JUMP,[this]))}playAnim(t){this.object.anims.play(t)}kill(){return j(this,void 0,void 0,(function*(){this.isDead||(this.isDead=!0,this.object.body.stop(),yield k.emit(this.ruler,k.event.ENT_DIED,[this]),this.destroy())}))}}var D=function(t,e,n,i){return new(n||(n=Promise))((function(s,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function o(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,o)}c((i=i.apply(t,e||[])).next())}))};let T=0;class P{constructor(t,e,n){this.ctx=t,this.scene=e,this.projectparser=n,this.list=new Set,this.groups=[],this.entities=new Map}new(t,e){return D(this,void 0,void 0,(function*(){const n=""!=e.sprite,i=r.a.texture+T++;if(n)yield(s=this.scene,a=i,o=e.sprite,c={frameWidth:e.width,frameHeight:e.height},new Promise(t=>{const e=new Image;e.src=o,S.appendChild(e),e.onload=function(){t(s.textures.addSpriteSheet(a,e,c))}}));else{let t=this.scene.make.graphics({add:!1,fillStyle:{color:e.color}});t.fillRect(0,0,e.width,e.height),t.generateTexture(i,e.width,e.height)}var s,a,o,c;const u={isHasSprite:n,spriteKey:i,data:e};this.entities.set(t,u),this.groups.push(this.scene.physics.add.group())}))}create(t,e){const n=this.entities.get(t);if(!n)throw new Error("[ EntityManager ]: Отсутствует сущность #"+t);const i=new A(this.ctx,this.scene,this.projectparser,this,n);return i.setPosition(e[0],e[1]),this.list.add(i),this.groups[t].add(i.object),i.init(),i}update(){this.list.forEach(t=>t.update())}setLayerForCollider(t){this.colliderlayer=t}}var B=function(t,e,n,i){return new(n||(n=Promise))((function(s,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function o(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,o)}c((i=i.apply(t,e||[])).next())}))};Object(i.a)("e/libs/phaser_3.23.0").then(()=>{window.$triggers.start=function(t){!function(t){const{Phaser:e}=window.$libs,{R:n}=window.$shared;let i=1;function u(e){t.loadProgressCB(i++,10,e)}let l,d,p={};const m=new a.a(t.project),f=m.mapData(t.mapId),b=m.mapSize(t.mapId),g=m.blocksTextures(),v=g.length-1,w=m.collisblBlocksIds(),x=m.sumStructDataList(),_=m.structsTextures(),S=m.structsSizeList(),j=m.audAll();let I,A;const D=m.cellSize;u("Инициализация");class T extends e.Scene{constructor(){super("MAIN")}preload(){}create(){return B(this,void 0,void 0,(function*(){const n={blocks:{collidableList:new Set}};u("Запуск контроллера правил");const i=k.newRuler();k.parse(i,m.rules),A=new P(n,this,m),u("Загрузка аудио"),yield h(this,r.a.sound,j.e),yield h(this,r.a.music,j.m),u("Загрузка текстур"),yield Object(o.a)(this,r.a.block,g,[D,D]),yield Object(o.a)(this,r.a.struct,_,S),u("Создание сущностей");for(let t=0;t<m.d_entities().length;t++){const e=m.getEntityData(t);yield A.new(t,e)}console.log("Resourses list: "),console.table({"Textures list":this.textures.list,"Audio list":this.cache.audio.entries});let s=this.add.graphics({fillStyle:{color:m.mapColor(t.mapId)}});u("Расположение структур"),E.a.init(this,f.layers.s,x,D,!1),u("Инициализация карты"),this.map=this.make.tilemap({key:r.a.map_main,data:f.layers.m,width:b.width,height:b.height,tileWidth:D,tileHeight:D}),s.fillRect(0,0,this.map.widthInPixels,this.map.heightInPixels);const a=Object(c.a)(this.map,r.a.block,v,[D,D]);p.m=this.map.createDynamicLayer("layer",a,0,0),A.setLayerForCollider(p.m),n.blocks.collidableList=new Set(w),this.map.setCollision(w),this.physics.world.setBounds(0,0,this.map.widthInPixels,this.map.heightInPixels),this.cameras.main.setBounds(0,0,this.map.widthInPixels,1e4),d=this.input.keyboard.createCursorKeys(),u("Подключение контроллеров"),I=this.input.keyboard.addKeys({left:e.Input.Keyboard.KeyCodes.A,right:e.Input.Keyboard.KeyCodes.D,space:e.Input.Keyboard.KeyCodes.SPACE}),this.input.keyboard.on("keydown_A",(function(t){if(!y.isDefined||!y.isEnabled())return;const e=y.hero();e.isDead||e.setMove(-1)})),this.input.keyboard.on("keydown_D",(function(t){if(!y.isDefined||!y.isEnabled())return;const e=y.hero();e.isDead||e.setMove(1)})),this.input.keyboard.on("keydown_SPACE",(function(t){if(!y.isDefined||!y.isEnabled())return;const e=y.hero();e.isOnGround()&&e.jump()})),this.input.keyboard.on("keyup_A",(function(t){if(!y.isDefined||!y.isEnabled())return;const e=y.hero();I.right.isUp&&e.setMove(0)})),this.input.keyboard.on("keyup_D",(function(t){if(!y.isDefined||!y.isEnabled())return;const e=y.hero();I.left.isUp&&e.setMove(0)})),u("Запуск процессов"),k.setContext({startdata:t,scene:this,map:this.map,entman:A,structmap:E.a,ruler:i}),u("Завершение"),l=!0,k.emit(i,k.event.GAME_INITIALIZED,[],[t.mapId])}))}update(t,e){l&&A.update()}}const C=s.a.game(t);C.physics.arcade.gravity.y=m.mapGravity(t.mapId);const N=new e.Game(Object.assign(Object.assign({},C),{scene:T})),O={setAudioSettings(t){const e=N.sound;null!=t.vol&&(e.volume=t.vol),null!=t.isMute&&(e.mute=t.isMute)},setPause(t){t?(N.scene.pause("MAIN"),N.sound.pauseAll()):(N.scene.resume("MAIN"),N.sound.resumeAll())},destroy(){N.destroy(!0),window.$triggers.clear()}};Object.assign(window.$triggers,O),window.$triggers.setAudioSettings(window.$data.aud)}(t)},window.$info.loadedEngineType="game",window.$events.onEngineLoad()})},15:function(t,e,n){"use strict";e.a={map_main:"0",img_tileset_blocks:"1",block:"B",struct:"S",texture:"T",layer:"L",sound:"N",music:"M"}},45:function(t,e,n){"use strict";var i=n(15);let s,r,a,o,c,u,l=[],h=!1;e.a={init(t,e,n,i,l=!1){s=new Map,r=new Map,a=t,c=i,o=n,u=l;for(const t in e)h=!0,this.putStruct(...t.split("."),e[t])},getData:()=>h?function(t){const e={};return[...t.entries()].forEach(t=>{e[t[0]]=t[1]}),e}(s):{},putStruct(t,e,n){const d=t+"."+e;let p=!1;if(s.get(d)===n)return p;if(s.has(d)&&(this.deleteStruct(t,e),p=!0),-1===n)return p;s.set(d,n),h=!0,p=!0;const m=o[n];let f;const y=t*c,b=e*c,g=i.a.struct+n;return u?f=a.add.image(y,b,g).setOrigin(0,0):(f=a.physics.add.image(y,b,g).setOrigin(0,0),m.isPhysical&&l.push(f),f.setImmovable(!0),f.body.allowGravity=!1),f.setDisplaySize(m.width,m.height),r.set(d,f),p},deleteStruct(t,e){const n=t+"."+e;s.delete(n),r.get(n).destroy(),r.delete(n)},addCollider(t){h&&a.physics.add.collider(l,t)}}},552:function(t,e,n){"use strict";var i=n(554),s=n(557);t.exports=function t(e){if(!e)return null;if(e instanceof ArrayBuffer)return e;if("string"==typeof e)return i(e);if(ArrayBuffer.isView(e))return e.byteOffset?e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength):e.buffer;var n;if(e.buffer||e.data||e._data)return n=t(e.buffer||e.data||e._data);if(Array.isArray(e))for(var r=0;r<e.length;r++)if(null!=e[r].length){e=s(e);break}return(n=new Uint8Array(e)).length?n.buffer:null}},553:function(t){t.exports=JSON.parse('{"Events":{"Program":{"[not event]":{}},"Game":{"Initialized":{"Map id":{"type":"number"}},"Ended":{"Is defeat":{"type":"boolean"}}},"Entity":{"Spawned":{"$":["Self"]},"Died":{"$":["Self"]},"Touched entity":{"$":["Self","Target"],"Target entity type":{"type":"number","_link":"d.e:n","_tarIx":true},"Side":{"_list":["None","Up","Right","Down","Left"],"_tarIx":true,"_isNegat":true}},"Touched block":{"$":["Self","TargetBlock"],"Block":{"type":"number","_link":"d.b:n","_tarIx":true},"Side":{"_list":["None","Up","Right","Down","Left"],"_tarIx":true,"_isNegat":true}},"In the region":{"$":["Self"],"X 1":{"type":"number"},"Y 1":{"type":"number"},"X 2":{"type":"number"},"Y 2":{"type":"number"}},"Jump":{"$":["Self"]}},"Camera":{},"Block":{}},"Actions":{"Program":{"Wait":{"Milliseconds":{"type":"number"}}},"Game":{"End game":{"Is defeat":{"type":"boolean"}}},"Entity":{"Spawn":{"Entity type":{"type":"number","_link":"d.e:n","_tarIx":true},"Position by X":{"type":"number"},"Position by Y":{"type":"number"},"Save to var":{"_var":true,"_opt":true}},"Kill":{"Entity":{"_var":true}},"Set control":{"Entity":{"_var":true}},"Add checking touch block":{"Entity":{"_var":true},"Block":{"type":"number","_link":"d.b:n","_tarIx":true}},"Add checking touch entity":{"Entity":{"_var":true},"With entity type":{"type":"number","_link":"d.e:n","_tarIx":true}},"Jump":{"Entity":{"_var":true},"Is strict":{"type":"boolean"}},"Set moving":{"Entity":{"_var":true},"By X":{"type":"number","min":-1,"max":1},"By Y":{"type":"number","min":-1,"max":1}},"Set invert moving":{"Entity":{"_var":true},"Is by X":{"type":"boolean"}},"Move":{"Entity":{"_var":true},"By X":{"type":"number"},"By Y":{"type":"number"},"Is impulse":{"type":"boolean"}}},"Camera":{"Follow entity":{"Entity":{"_var":true}},"Set zoom":{"Value":{"type":"number"}},"Set lerp":{"X":{"type":"number"},"Y":{"type":"number"}}},"Block":{"Remove":{"Block":{"_var":true}},"Replace":{"To position of block":{"_var":true},"New block type":{"type":"number","_link":"d.b:n","_tarIx":true}}},"Audio":{"Play sound":{"Sound":{"type":"number","_link":"a.e:n","_tarIx":true}},"Play music":{"Sound":{"type":"number","_link":"a.m:n","_tarIx":true}},"Stop sound":{"Sound":{"type":"number","_link":"a.e:n","_tarIx":true}},"Stop music":{"Sound":{"type":"number","_link":"a.m:n","_tarIx":true}}},"Animation":{"Play":{"Entity":{"_var":true},"Animation":{"type":"string","_link":"n:n?_c=e","_tarIx":true}},"Set flippable for entity":{"Entity":{"_var":true},"By X":{"type":"boolean"},"By Y":{"type":"boolean"}},"Shake camera":{"Duration":{"type":"number"},"Intensity":{"type":"number"}},"Camera fade out":{"Duration":{"type":"number"},"Color":{"type":"string","pattern":"^[\\\\dA-Fa-f]{6}$","example":"00AAFF"}},"Set background image":{"Img id":{"type":"number"},"Rect points":{"type":"array","items":{"type":"number"},"minItems":4,"maxItems":4}}},"Event":{},"Control":{"Set enable status":{"Is enabled":{"type":"boolean"}}}}}')},554:function(t,e,n){"use strict";var i=n(555),s=n(556);function r(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e.buffer}t.exports=function(t){if("string"!=typeof t)throw Error("Argument should be a string");return/^data\:/i.test(t)?function(t){var e=(t=t.replace(/\r?\n/g,"")).indexOf(",");if(-1===e||e<=4)throw new TypeError("malformed data-URI");for(var n=t.substring(5,e).split(";"),s=!1,a="US-ASCII",o=0;o<n.length;o++)"base64"==n[o]?s=!0:0==n[o].indexOf("charset=")&&(a=n[o].substring(8));var c=unescape(t.substring(e+1));s&&(c=i(c));var u=r(c);return u.type=n[0]||"text/plain",u.charset=a,u}(t):(s(t)&&(t=i(t)),r(t))}},555:function(t,e){t.exports=function(t){return atob(t)}},556:function(t,e,n){!function(n){"use strict";function i(t,e){if(t instanceof Boolean||"boolean"==typeof t)return!1;if(e instanceof Object||(e={}),e.hasOwnProperty("allowBlank")&&!e.allowBlank&&""===t)return!1;var n="(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}==|[A-Za-z0-9+/]{3}=)?";return e.mime&&(n="(data:\\w+\\/[a-zA-Z\\+\\-\\.]+;base64,)?"+n),!1===e.paddingRequired&&(n="(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}(==)?|[A-Za-z0-9+\\/]{3}=?)?"),new RegExp("^"+n+"$","gi").test(t)}t.exports&&(e=t.exports=i),e.isBase64=i}()},557:function(t,e,n){var i=n(558);t.exports=function(t,e,n){if(!t)throw new TypeError("must specify data as first parameter");if(n=0|+(n||0),Array.isArray(t)&&t[0]&&"number"==typeof t[0][0]){var s,r,a,o,c=t[0].length,u=t.length*c;e&&"string"!=typeof e||(e=new(i(e||"float32"))(u+n));var l=e.length-n;if(u!==l)throw new Error("source length "+u+" ("+c+"x"+t.length+") does not match destination length "+l);for(s=0,a=n;s<t.length;s++)for(r=0;r<c;r++)e[a++]=null===t[s][r]?NaN:t[s][r]}else if(e&&"string"!=typeof e)e.set(t,n);else{var h=i(e||"float32");if(Array.isArray(t)||"array"===e)for(e=new h(t.length+n),s=0,a=n,o=e.length;a<o;a++,s++)e[a]=null===t[s]?NaN:t[s];else 0===n?e=new h(t):(e=new h(t.length+n)).set(t,n)}return e}},558:function(t,e){t.exports=function(t){switch(t){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}},62:function(t,e,n){"use strict";function i(t){return{type:t.WEBGL,pixelArt:!0,scale:{autoCenter:Phaser.Scale.CENTER_BOTH,mode:t.Scale.ENVELOP}}}e.a={base:{editor:{scrollMapSpeed:[.8,2],zoomInterval:[.2,2],zoomSpeed:.001}},game(t){const{Phaser:e}=window.$libs,n=Object.assign(Object.assign({},i(e)),{parent:t.parent,physics:{default:"arcade",arcade:{gravity:{y:600},debug:window.$data.isDebug}}});return n.scale.fullscreenTarget=t.parent,n},editor(t){const{Phaser:e}=window.$libs,n=Object.assign({},i(e));return n.scale.parent=t.parent,n}}},85:function(t,e,n){"use strict";e.a=function(t,e,n,i){return new Promise((s,r)=>{if(!n||!n.length)return s();let a=n.length;t.textures.on("addtexture",(function e(){a--,a<=0&&(t.textures.off("addtexture",e),clearTimeout(void 0),s())}));const o=2===i.length&&"number"==typeof i[0]&&"number"==typeof i[1];n.forEach((n,s)=>{const r=e+s;let c=o?i[0]:i[s][0],u=o?i[1]:i[s][1];if(6!==n.length)t.textures.addBase64(r,n);else{const e=+("0x"+n);let i=t.make.graphics({add:!1,fillStyle:{color:e}});i.fillRect(0,0,c,u),i.generateTexture(r,c,u),a--}}),a<=0&&s()})}}});